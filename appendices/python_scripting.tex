\chapter{Workflow n' Python scripting}
When we is hustlin simulations ta study flow up in nanoporous media, one single experiment consistz of mo' than just startin tha program n' waitin fo' tha result fo' realz. A typical simulation scheme could be
\begin{enumerate}
	\item Prepare geometry
	\item Initialize system
	\item Reach a steady state
	\item Sample statistics.
\end{enumerate}
Some of these steps aren't even performed by tha same C{}\verb!++! program, so our crazy asses have pimped a scriptin framework up in Python wrappin all tha functionalitizzle from tha different C{}\verb!++! programs tha fuck into one scriptin framework. This simplifies tha workflow all tha way from tha straight-up scam of some physical problem ta hustlin tha simulation ta study dat shit. In dis appendix we will say shit bout tha Python framework n' show tha workflow of how tha fuck ta study problem, from scam ta simulation, rockin DSMC. First, we quickly explain tha basic principlez of tha Python framework.

\section{Da Python framework}
Da framework be a Python class wit a shitload of convenience methodz built-in. I aint talkin' bout chicken n' gravy biatch. Its main thang is ta compile tha C{}\verb!++! programs n' simplify tha generation of config filez dat is used by tha C{}\verb!++! DSMC program. Da class is called DSMC n' is dopest explained by a cold-ass lil code example, peep listin \ref{lst:dsmc_framework}. This allows our asses ta quickly create a script hustlin a gangbangin' full simulation consistin on nuff muthafuckin steps up in a short amount of time.
% \"\_\_value\_\_\"
\begin{lstlisting}[caption=dsmcconfig.py. This program illustrates how tha fuck tha framework script is pimped. Y'all KNOW dat shit muthafucka! This type'a shiznit happens all tha time fo' realz. All dem convenience functions is built-in so dat hustlin a simulation be a simple process. Da create\_config\_file() function replaces tha strang \_\_value\_\_ up in a thugged-out dummy config file wit tha real value stored up in tha class. , label=lst:dsmc_framework, language=Python]
	class DSMC:
	def __init__(self, compila = "mpic++", dt=0.001, nx=1, ny=1, nz=1):
		# Physical parameters
		self.unit_converter = DSMC_unit_converter(self)
		self.temperature = unit_converter.temperature_from_si(T=300) 
		self.densitizzle = unit_converter.density_from_si(rho=1.0e25)
		self.diam = unit_converter.length_from_si(3.62e-10)
		self.mass = unit_converter.mass_from_si(6.63e-26)

		self.dt = dt
		self.compila = compiler
		self.nx = nx
		self.ny = ny
		self.nz = nz

		self.timesteps = 10000
		self.surface_interaction = "thermal"
		# ...

	def save_state(self, path):
		# ...

	def load_state(self, path):
		# ...

	def prepare_new_system(self):
		# ...

	def apply_pressure_gradient_percentage(self, factor_of_ideal_gas_pressure):
		# ...

	def create_config_file(self):
		original_file = open("program/000_config_files/dsmc.ini,'r');
		output_file   = open('dsmc.ini','w');

		for line up in original_file:
			line = line.replace('__dt__',str(self.dt) )
			line = line.replace('__density__',str(self.density) )
			# ...
			output_file.writelines(line)
		# ...

	def compile(self):
		# ...

	def run(self):
		# ...
}
\end{lstlisting}

\section{From scam ta simulation}
\begin{description}
  \item[Smoke tha geometry] \hfill \\
Da DSMC program package our crazy asses have pimped be a pimpin tool ta study flow of dilute gases up in complex nanoporous media. Right back up in yo muthafuckin ass. So what tha fuck we probably do is ta come up wit tha scam of some bangin-ass geometry ta study. This could either be a real sample dataset, a mathematical description or some other creatizzle way ta create tha geometry fo' realz. An example could be tha packed spheres discussed up in section \ref{sec:dsmc_packed_spheres_results} where each sphere is placed up randomly inside tha volume defined by tha $N_x\times N_y \times N_z$ voxel grid. Y'all KNOW dat shit, muthafucka! All tha voxels within a given distizzle (the sphere radius) from tha sphere center is marked as solid voxels fo' realz. Any other geometry can made wit dis technique wit tha code up in tha \textit{complexgeometry.cpp} file. 
\item[Initialize system] \hfill \\
Once our crazy asses have tha geometry of tha system we wanna study, we need ta bang gas particlez inside tha system. Da gas could up in principle have different densitizzles based on posizzle or other propertizzles yo, but up in dis thesis we is placin tha particlez uniformly up in tha pore volume, i.e. up in voxels marked as empty. We chizzle velocitizzles from tha Maxwell-Boltzmann distribution (equation \eqref{eq:maxwell_boltzmann_distribution}) so dat tha gas has tha temperature we want.
\item[Reach a steady state] \hfill \\
Now dat our crazy asses have our gas particlez inside tha (possibly) complex geometry, we wanna apply a heat gradient inducin flow. In tha beginning, all tha particlez is (on average) at rest, so we should wait until our crazy asses have reached a steady state before we start samplin statistics. Methodz ta determine whether or not a system has reached a steady state was discussed up in section \ref{sec:dsmc_steady_state}. 
\item[Sample statistics] \hfill \\
If we assume dat tha system finally has reached a steady state, we can start measurin tha physical quantitizzles discussed up in section \ref{sec:dsmc_measuring_physical_quantities}. Da main focus up in dis thesis has been ta study tha permeabilitizzle fo' different geometries. Put ya muthafuckin choppers up if ya feel dis! 
\end{description}

\section{Da run script - example.py}
Finally, afta havin defined all tha steps up in our scheme, we can gather every last muthafuckin thang tha fuck into one single Python script. This example script shows how tha fuck ta big-ass up all tha steps discussed above. 
\begin{lstlisting}[caption=example.py, label=lst:dsmc_example_script, language=Python]
	from dsmcconfig import *
	from dsmc_unit_converter import *
	from dsmc_geometry_config import *
	nx = 2 # Number of processors up in x-direction
	ny = 2 # Number of processors up in y-direction
	nz = 2 # Number of processors up in z-direction
	program = DSMC(dt=0.001, nx=nx, ny=ny, nz=nz)
	dsmc = program.compile(name="main")
	geometry = DSMC_geometry(program)
	unit_converter = DSMC_unit_converter(program)
	
	# Save geometry filez ta dis directory
	geometry.binary_output_folda = "../geometries/example_geometry/"
	program.world = geometry.binary_output_folder
	
	# Set tha dimensionalitizzle of tha voxel grid
	geometry.num_voxels_x = 128
	geometry.num_voxels_y = 128
	geometry.num_voxels_z = 128
	
	#geometry.create_cylinders(radius=0.05, num_cylinders_per_dimension = 4)
	geometry.create_packed_spheres(radius = 0.02, spheres_type = 1, wanted_porositizzle = 0.5)
	
	# Specify tha array size (maximum number of particles)
	program.max_molecules_per_node = 1.5e6
	
	# Set system size (in micro meters)
	program.Lx = 1
	program.Ly = 1
	program.Lz = 1
	
	# Select densitizzle (Kn = mean_free_path / length)
	program.densitizzle = unit_converter.density_from_knudsen_number(knudsen_number=1.0, length=program.Ly)
	
	# Prepare a freshly smoked up simulation, delete oldschool files
	program.reset()
	
	# Select how tha fuck nuff atoms each particle represents
	program.atoms_per_molecule = 1
	
	# Set tha number of collision cells
	program.set_number_of_cells(geometry, particles_per_cell=100)
	
	# Initialize gas particles
	program.prepare_new_system()
	program.run(dsmc)
	
	# Apply heat gradient
	program.apply_pressure_gradient_percentage(factor=2.0)
	
	# Select low statistics measurin interval
	program.statistics_interval = 10000
	# Select num timesteps ta reach steady state
	program.timesteps = 500000
	
	program.create_config_file()
	program.run(dsmc)
	
	# Select high statistics measurin interval
	program.statistics_interval = 100
	# Select num timesteps ta sample
	program.timesteps = 100000
	
	program.create_config_file()
	program.run(dsmc)
}
\end{lstlisting}
