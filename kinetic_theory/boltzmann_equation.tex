\section{The Boltzmann equation}
\label{sec:boltzmann_equation}
In the section \ref{sec:kinetic_theory_distribution_function}, we introduced the distribution function $f$ that describes the density in a $6N$ dimensional phase space. Now, if we know the distribution function at $t=0$, we could in principle compute any property of the system. But at a later time $t=\tau$, the distribution function might have changed, unless, of course, $\partial_t f = 0$ (in which the system would be in what we call an equilibrium state). We can, by applying conservation of probability, derive an equation of motion for $f$. This equation is called the Boltzmann equation. It describes how $f$ evolves through time by assuming that any change of density (read probability) around a point $(\vec r, \vec v)$ at the time $t$ must be due to
\begin{itemize}
	\item flow through a surface in the phase space,
	\item an external force, or
	\item internal collisions.
\end{itemize}
All three will change $f$ in different ways. For simplicity, we will first assume that the particles do not collide and derive the \textit{collisionless Boltzmann equation}. But do not worry, we will add the collision term later and end up with the full Boltzmann equation.

\subsection{The collisionless Boltzmann equation}
Consider the density around the phase space point $(\vec r,\vec v)$ at the time $t$. If we assume no forces, and that the total number of particles has not changed, a time $dt$ later, the density has moved to $(\vec r + \vec vdt, \vec v)$. Conservation of probability states that any change of $f$ within a volume $\Omega$ must flow through the boundary $\partial \Omega$
\begin{align}
	\frac{\dm }{\dm t}\int_\Omega f \dm \vec r \dm \vec v &= -\int_{\Omega_v}\dm \vec v\int_{\partial \Omega_r} f(\vec v\cdot \vec n_r) \dm S_r\\
	&= -\int_{\Omega_v}\dm \vec v\int_{\Omega_r} \nabla_\vec r\cdot(f\vec v) \dm \vec r = -\int_{\Omega} \nabla_\vec r\cdot(f\vec v) \dm \vec v\dm \vec r
\end{align}
which becomes
\begin{align}
	\dpart{f}{t} + \nabla_\vec r \cdot(f\vec v) = \dpart{f}{t} + \vec v\cdot\nabla_\vec r f = 0
\end{align}
since $\vec v$ is independent of $\vec r$. We can extend this equation by adding the effects of an external force $\vec F$ that changes the velocity in the same way as the position was changed above (except for the factor $1/m$)
\begin{align}
	\label{eq:collisionless_boltzmann}
	\dpart{f}{t} + \vec v\cdot\nabla_\vec r f + \nabla_\vec v \cdot \frac{\vec F}{ m}f = 0,
\end{align}
which we call the collisionless Boltzmann equation. It is a good approximation to describe the dynamics of very dilute gases where intermolecular collisions occur rarely. But we should not ignore collisions between particles, so as promised, we will now see that by treating collisions will appear as an additional term.
\subsection{The collision operator}
We consider a dilute gas so we can assume that only binary collisions occur (we ignore the contribution from collisions between three or more particles at a time). We also assume that the total energy and momentum is conserved in all collisions. Then consider two particles $i$ and $j$ moving towards each other with velocities $\vec v$ and $\vec v_1$, and relative velocity $\vec g = \vec v - \vec v_1$. We define particle $i$ as the \textit{incident} particle and $j$ as the \textit{target} particle. After the collision, the particles will have velocities $\vec v'$ and $\vec v_1'$ with relative velocity $\vec g' = \vec v' - \vec v_1'$. In order to make the calculations simpler, we change the frame of reference. If we choose the target particle as initial frame of reference, we see that the velocity of the incident particle becomes $\tilde {\vec v} = \vec g$ and $\tilde {\vec v}' = \vec g'$. Since momentum is conserved, we know that the relative velocity must remain constant $|\vec g| = |\vec g'|$ during the collision. The direction of $\vec g'$ is given by the angles $\phi$ and $\theta$ with $\hat {\vec z}$ along $\vec g$ and $\phi \in [0, 2\pi], \theta \in [0, \pi]$. We can express $\vec g'$ as
\begin{align}
	\vec g' = \vec g - 2\unitvector e(\unitvector e\cdot\vec g),
\end{align}
where $\unitvector e$ is an arbitrary unit vector. \todo{Illustrate this with a figure?} If we multiply by $\unitvector e$, we see that 
\begin{align}
	\unitvector e\cdot \vec g' = \unitvector e\cdot\left[\vec g - 2\unitvector{e}(\unitvector e\cdot\vec g)\right] = -\unitvector e \cdot \vec g
\end{align}
which gives the symmetric relation
\begin{align}
	\vec g = \vec g' - 2\unitvector e(\unitvector e\cdot\vec g').
\end{align}
The angle between $\vec g$ and $\vec g'$ is $\theta$, so
\begin{align}
	\vec g'\cdot \vec g = g^2\cos\theta = g^2(1 - 2\cos \chi),
\end{align}
where $\chi$ is the angle between $\unitvector e$ and $\vec g$ which gives the relation
\begin{align}
	\theta = \pi - 2\chi.
\end{align}
We now define the solid angle element $\dm\Omega=\sin\theta \dm\theta \dm\phi$ about $\vec g'$ 
\begin{align}
	g \dm\Omega &= g\sin\theta \dm\theta \dm\phi = 2g\sin(\pi - 2\chi)\dm\chi \dm\phi\\
	&= 4g\cos\chi\sin\chi \dm\chi \dm\phi = 4\left|\unitvector e\cdot\vec g\right|\sin\chi \dm\chi \dm\phi\\
	&= 4\left|\unitvector e\cdot\vec g\right|\dm^2e,
\end{align}
where $\dm^2e = \sin\chi \dm\chi \dm\phi$ is a solid angle element about $\unitvector e$. In the following, we will calculate the scattering cross section which is the \textit{area} that describes the likelyhood of an incident particle being scattered by the target particle. We denote the number density $\rho_n$ and find that the incident flux is $\rho_n g$. The rate $h_{\dm\Omega}'$ of scattered particles into $\dm\Omega$ is
\begin{align}
	\label{eq:partial_scattering_rate}
	h_{\dm\Omega}' = \rho_n g\sigma \dm\Omega,
\end{align}
where the proportionality constant $\sigma$ is the cross section. We might have several target particles colliding independently of each other which will contribute to the scattering rate. If we have $n_t$ such particles, we obtain the total scattering rate $h_{\dm\Omega}$ by multiplying \eqref{eq:partial_scattering_rate} by $n_t$
\begin{align}
	h_{\dm\Omega} = n_t\rho_n g\sigma \dm\Omega.
\end{align}
The \textit{differential} cross section $\sigma$ depends on $\vec g$ and $\vec g'$, so we denote it as $\sigma = \sigma(\vec g\rightarrow \vec g')$, whereas the \textit{total} cross section $\sigma_T$ is given by integrating over all solid angles
\begin{align}
	\sigma_T = \int \sigma \dm\Omega.
\end{align}
We will now look at particles with velocities in the range $[\vec v, \vec v + \dm\vec v]$ incident on target particles with velocities in the range $[\vec v_1, \vec v_1 + \dm\vec v_1]$. The incident flux is $gf(\vec v,\vec r)\dm\vec v$ and the number of target particles is $f(v_1,\vec r)\dm\vec v_1\dm\vec r$. The rate at which particles with velocity $\vec v_1$ are scattered by particles with velocity $\vec v$ is \todo{Check if these $f$'s should be normalized}
\begin{align}
	f(\vec v)f(\vec v_1) g \sigma \dm\Omega \dm\vec v \dm\vec v_1 \dm\vec r = f(\vec v)f(\vec v_1)4\left|\unitvector e\cdot \vec g\right| \sigma \dm^2e \dm \vec v \dm\vec v_1 \dm \vec r.
\end{align}
The rate of loss is the rate of which particles in $\dm\vec v\dm\vec r$ are being hit by other particles. We can calulate this by integrating over all solid angles $\dm^2 e$ and incident velocities $\dm \vec v$
\begin{align}
	\text{rate of loss} = \left[\int f(\vec v)f(\vec v_1)4\left|\unitvector e \cdot \vec g \right|\sigma \dm^2 e\dm \vec v_1\right]\dm \vec v\dm \vec x.
\end{align}
We also have the inverse event, incident particles with velocity $\vec v'$ hitting target particles with velocity $\vec v_1'$ so that the final velocity of the target particles is $\vec v$. This is calculated with the same idea
\begin{align}
	\text{rate of gain} = \left[\int f(\vec v')f(\vec v_1')4\left|\unitvector e \cdot \vec g \right|\sigma \dm^2 e\dm \vec v_1\right]\dm\vec v\dm\vec x,
\end{align}
since $|\unitvector e\cdot \vec g| = |\unitvector e\cdot \vec g'|$ and $\dm\vec v'\dm\vec v_1' = \dm\vec v\dm\vec v_1$. The total change in the distribution function is given by the functional $J[f]$
\begin{align}
	J[f] &= \int \dm\vec v_1 \dm^2 e4|\unitvector e\cdot\vec g|\sigma[f'f_1' - ff_1]\\
	&= \int \dm\vec v_1 \dm\Omega g \sigma[f'f_1' - ff_1],
\end{align}
where $f = f(\vec r, \vec v, t)$ and $f_1 = f(\vec r, \vec v_1, t)$. The full Boltzmann equation is then given by
\begin{align}
	\label{eq:boltzmann_equation}
	\dpart{f}{t} + \vec v\cdot \nabla_\vec r f + \frac{\vec F}{m}\cdot\nabla_\vec v f = J[f].
\end{align}
In the derivation of the collision operator $J[f]$, we assumed binary collisions only. This is a decent approximation that holds for low densities. By defining the force range $D$ and the dimensionless parameter $\nu = \rho_n D^3$, the Boltzmann equation is valid when $\nu$ is small \cite{mclennan1989introduction}. $D^3$ defines a volume around a particle in which the forces cannot be neglected. This makes $\nu$ the average number of particles within that volume. If that number is small (less than unity) then we can safely neglect collisions between three or more particles.
\section{\textit{H}-theorem}

Boltzmann's $H$-theorem is a powerful result that gives us all the theoretical tools we need to implement the DSMC method. We define the $H$-function as
\begin{align}
	H(t) = \langle \ln f \rangle = \int f(\vec r, \vec v, t)\ln f(\vec r, \vec v, t)d\vec r d\vec v
\end{align}
and differenciate with respect to time
\begin{align}
	\frac{dH}{dt} = \int \dpart{f}{t}\ln f d\vec r d\vec v + \int \dpart{f}{t} d\vec r d\vec v = \int \dpart{f}{t}\ln f d\vec r d\vec v
\end{align}
where we have used that the number of particles is conserved
\begin{align}
	\int \dpart{f}{t}d\vec r d\vec v = \frac{d}{dt} \int fd\vec r d\vec v = \frac{dN}{dt} = 0.
\end{align}
We multiply the Boltzmann equation by $\ln f$ and integrate
\begin{align}
	% \int \dpart{f}{t}\ln f d\vec r d\vec v = -\int (\ln f)\vec v\cdot \nabla_\vec r f d\vec r d\vec v - \int (\ln f) {\vec F\over m}\cdot \nable_\vec v f d\vec rd\vec v + \int \ln f J[f] d\vec r d\vec v
	balle
\end{align}

\section{Maxwell-Boltzmann distribution as equilibrium}
\label{sec:maxwell_boltzmann_distribution}
\begin{align}
	\label{eq:maxwell_boltzmann_distribution}
	P(v_i)\dm {v_i} = \sqrt\frac{m}{ 2\pi k_BT}e^\frac{-mv_i^2}{ 2k_BT}\dm {v_i},
\end{align}
\section{Mean free path}
\label{sec:mean_free_path_calculation}
The collision frequency can be calculated through the mean free path, which is the average distance a molecule travels between collisions. The mean free path for a gas is estimated by looking at the \textit{effective collision area}, see figure \ref{fig:effective_collision_area}. The effective collision area is then
\begin{align}
	A = \pi d^2,
\end{align}
where $d$ is the molecular diameter. Two molecules with velocities $\vec v_1$ and $\vec v_2$ have the relative velocity $\vec v_{rel} = \vec v_1 - \vec v_2$. The norm is given by
\begin{align}
	v_{rel} &= \sqrt{\vec v_{rel}\cdot \vec v_{rel} } = \sqrt{ (\vec v_1 - \vec v_2)(\vec v_1 - \vec v_2)}\\
	&= \sqrt{\vec v_1\cdot \vec v_1 - 2\vec v_1\vec v_2 + \vec v_2\vec v_2}.
\end{align}
The average relative velocity is calculated by assuming that the velocities are completely random and hence not correlated, and that the molecules have the same mean speed $\langle v\rangle$
\begin{align}
	\bar v_{rel} &= \sqrt{\vec v_1^2 + \vec v_2^2} = \sqrt 2 \langle v\rangle,
\end{align}li
During a time $\tau$ and average relative molecular velocity $\sqrt 2 \langle v\rangle$, the total volume sweeped out by the particle is given as
\begin{align}
	V = \sqrt 2 \pi d^2\langle v\rangle \tau,
\end{align}
which in turn gives the number of collisions during such a volume
\begin{align}
	\label{eq:num_collisions}
	n_{coll} = V\rho_n = \sqrt 2 \pi d^2\langle v\rangle \rho_n \tau,
\end{align}
where $\rho_n$ is the number density. The mean free path is then calculated as the length of the path divided by the number of collisions
\begin{align}
	\label{eq:mean_free_path}
	\lambda = \frac{\langle v\rangle \tau}{ \sqrt 2 \pi d^2\langle v\rangle \rho_n\tau} = \frac{1 }{ \sqrt 2 \pi d^2 \rho_n}
\end{align}
\section{Mean collision time}
\begin{align}
	\label{eq:coll_frequency}
	f_{coll} = \rho_n \pi \sigma^2 \langle v_r \rangle
\end{align}